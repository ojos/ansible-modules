---
- name: Tap Homebrew Cask
  homebrew_tap: >
    tap=caskroom/cask
    state=present
  when: ansible_os_family == 'Darwin'

- name: Tap external Homebrew Cask repositories
  homebrew_tap: >
    tap={{ item }}
    state=present
  with_items: "{{ homebrew_cask_repositories }}"
  when: ansible_os_family == 'Darwin' and homebrew_cask_repositories|length > 0

- name: Install/Upgrade Homebrew Cask packages
  homebrew_cask: >
    name={{ item.name | default(item) }}
    state={{ item.state | default('present') }}
  with_items: "{{ homebrew_cask_packages }}"
  when: ansible_os_family == 'Darwin' and homebrew_cask_repositories|length > 0
  environment: 
    HOMEBREW_CASK_OPTS: "{{ homebrew_cask_options }}"